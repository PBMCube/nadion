/*! Nadion v0.1.0 | (c) 2013 Joshua C Shepard */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.Nadion=b()}(this,function(){"use strict";var a=a||window.Phaser||null,b=b||{name:"nadionBasedGame",VIEW_WIDTH:640,VIEW_HEIGHT:480,go:function(c){var d,e=a.AUTO,f=location.search.substring(1).split("&");for(var g in f){var h=f[g].split("=");h.length>1&&"render"===decodeURIComponent(h[0])&&(d=decodeURIComponent(h[1].replace(/\+/g," ")))}"string"==typeof d&&"canvas"===d&&(e=a.CANVAS);new a.Game(b.VIEW_WIDTH,b.VIEW_HEIGHT,e,"",c)},__extends:function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},saveState:function(a,b){window.localStorage.setItem(a,JSON.stringify(b))},loadState:function(a){var b=window.localStorage.getItem(a);return b?JSON.parse(b):null},findNamedItemInArray:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name&&a[c].name==b)return c;return void 0},findNamedItemInGroup:function(b,c){var d=function e(b){var d=b.cursor,f=d;do{if(f instanceof a.Group)return b.cursor=d,e(f);if(f.name===c)return b.cursor=d,f;b.next(),f=b.cursor}while(f&&f!==d);return b.cursor=d,null}(b);return d},resolveTarget:function(a){if("Nadion"===a.target_name)a.target=b;else if("state"===a.target_name)a.target=a.game.state.states[a.game.state.current];else if(a.target=b.findNamedItemInGroup(a.game.world,a.target_name),!a.target){var c=a.game.particles.emitters[a.target_name];void 0!==c&&(a.target=c)}},wrapText:function(a,b){b=b||75;var c=".{1,"+b+"}(\\s|$)|\\S+?(\\s|$)";return a.match(RegExp(c,"g")).join("\n")}};return b.Controls=function(b,c,d){b.input.addPointer(),b.input.addPointer(),b.input.multiInputOverride=a.Input.TOUCH_OVERRIDES_MOUSE;for(var e=b.input.pointer1,f=b.input.pointer2,g=c/d,h=[],i=0,j=0;d>j;j++){var k={left:i,right:i+g};h.push(k),i+=g}var l=[],m=[],n=function(a){return function(){var b;e.isDown&&(b=e.x);var c;return f.isDown&&(c=f.x),void 0!==b&&b>a.left&&b<a.right?1:void 0!==c&&c>a.left&&c<a.right?2:void 0}};for(j=0;d>j;j++){var o=h[j];l.push(n(o)),m.push(void 0)}var p=function(a,b,c){m[a]={callback:b,context:c}},q=function(a){for(var b=0;d>b;b++)m[b]&&a.x>h[b].left&&a.x<h[b].right&&m[b].callback.call(m[b].context)};b.input.onDown.add(q);var r=function(){var a=b.add.group();a.alpha=.33,a.visible=!0;var c=(g-64)/2,d=b.add.sprite(0,0,"button-left");d.fixedToCamera=!0,d.cameraOffset.x=h[0].left+c,d.cameraOffset.y=320,a.add(d),d=b.add.sprite(0,0,"button-right"),d.fixedToCamera=!0,d.cameraOffset.x=h[1].left+c,d.cameraOffset.y=320,a.add(d),d=b.add.sprite(0,0,"button-circle"),d.fixedToCamera=!0,d.cameraOffset.x=h[3].left+c,d.cameraOffset.y=320,a.add(d),d=b.add.sprite(0,0,"button-square"),d.fixedToCamera=!0,d.cameraOffset.x=h[4].left+c,d.cameraOffset.y=320,a.add(d)};return{buttonPressed:l,setOnPressedCallback:p,addButtons:r}},function(){function c(a){"reset"in a&&a.reset(),"revive"in a&&a.revive()}function d(a){a.is_player_sprite||a.updateObject()}b.Level=function(){this.tile_width=void 0,this.tile_height=void 0,this.tilemap=void 0,this.tileset_url=void 0,this.sounds=void 0,this.background_music=void 0,this.spritesheets=void 0,this.images=void 0,this.loading_text_style=void 0,this.background_color=void 0,this.game_namespace=void 0},b.Level.prototype.preload=function(){var c;for(this.game.load.tilemap("level",this.tilemap,null,a.Tilemap.TILED_JSON),this.game.load.tileset("tiles",this.tileset_url,this.tile_width,this.tile_height),c=0;c<this.spritesheets.length;c++){var d=this.spritesheets[c];this.game.load.spritesheet(d.name,d.url,d.width,d.height)}for(c=0;c<this.images.length;c++){var e=this.images[c];this.game.load.image(e.name,e.url)}for(c=0;c<this.sounds.length;c++){var f=this.sounds[c],g=f.url+".mp3",h=f.url+".ogg";this.game.load.audio(f.name,[g,h])}this.game.pre=this.game.add.sprite(0,0,"preload"),this.game.pre.x=(b.VIEW_WIDTH-this.game.pre.width)/2,this.game.pre.y=(b.VIEW_HEIGHT-this.game.pre.height)/2,this.game.load.setPreloadSprite(this.game.pre),this.game.pre_text=void 0,this.loading_text_style&&(this.game.pre_text=this.game.add.bitmapText(b.VIEW_WIDTH/2,b.VIEW_HEIGHT/2+.2*b.VIEW_HEIGHT," 0%",this.loading_text_style),this.game.pre_text.x=this.game.camera.x+(b.VIEW_WIDTH-this.game.pre_text.width)/2),this.game.load.onFileComplete.removeAll(),this.game.load.onFileComplete.add(function(a){return function(c){a.pre.x=a.camera.x+(b.VIEW_WIDTH-a.pre.width)/2,a.pre.y=a.camera.y+(b.VIEW_HEIGHT-a.pre.height)/2,a.pre_text&&(a.pre_text.setText(c+"%"),a.pre_text.x=a.camera.x+(b.VIEW_WIDTH-a.pre_text.width)/2,a.pre_text.y=a.camera.y+b.VIEW_HEIGHT/2+.2*b.VIEW_HEIGHT)}}(this.game))},b.Level.prototype.create=function(){this.game.pre.alive=!1,this.game.pre.visible=!1,this.game.pre_text&&(this.game.pre_text.alive=!1,this.game.pre_text.visible=!1),this.showLayer1=!0,this.showLayer2=!0,this.showLayer3=!0,this.showLayer4=!0,this.showLayer5=!0,this.showFramerate=!1,this.showDebugInfo=!1,this.setupDeveloperMode(),this.game.stage.backgroundColor=this.background_color,this.background_music&&(this.music=this.game.add.audio(this.background_music.name,1,!0),this.music.play("",0,this.background_music.volume,!0)),this.paused_image_key&&(this.game.paused_image=new a.Sprite(this.game,0,0,this.paused_image_key),this.game.paused_image.visible=!1,this.game.paused_image.fixedToCamera=!0,this.game.add.existing(this.game.paused_image)),this.setupMap(),this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this),this.layers=[],this.image_layers=[],this.groups=[],this.emitters=[],this.triggers=[],this.alarms=[],this.areas=[],this.createLayers(),this.setupInput(),this.game.camera.follow(this.player,a.Camera.FOLLOW_PLATFORMER),this.updates=0,this.alarms.forEach(function(a){a.start()})},b.Level.prototype.onPause=function(){this.game.sound.pauseAll()},b.Level.prototype.onResume=function(){this.game.sound.resumeAll()},b.Level.prototype.setupInput=function(){this.controls=new b.Controls(this.game,b.VIEW_WIDTH,5),this.game.device.desktop||this.controls.addButtons()},b.Level.prototype.setupMap=function(){this.map=this.game.add.tilemap("level"),this.tileset=this.game.add.tileset("tiles");var a,b,c=this.game.cache.getTilemapData("level").data,d=c.tilesets[0].tileproperties;for(var e in d)if(d.hasOwnProperty(e)&&(a=+e,!isNaN(a)))if(b=d[e],void 0!==b.solid)"slopeDownRight"===b.solid?this.tileset.tiles[a].slopeDownRight=!0:"slopeDownLeft"===b.solid&&(this.tileset.tiles[a].slopeDownLeft=!0),this.tileset.setCollision(a,!0,!0,!0,!0);else{var f=!1,g=!1,h=!1,i=!1;void 0!==b["solid-left"]&&(f=!0),void 0!==b["solid-right"]&&(g=!0),void 0!==b["solid-up"]&&(h=!0),void 0!==b["solid-down"]&&(i=!0),this.tileset.setCollision(a,f,g,h,i)}},b.Level.prototype.setupDeveloperMode=function(){if(this.game.developer_mode){var b=this.game.input.keyboard.addKey(a.Keyboard.ONE);b.onDown.add(function(){this.showLayer1=!this.showLayer1},this);var c=this.game.input.keyboard.addKey(a.Keyboard.TWO);c.onDown.add(function(){this.showLayer2=!this.showLayer2},this);var d=this.game.input.keyboard.addKey(a.Keyboard.THREE);d.onDown.add(function(){this.showLayer3=!this.showLayer3},this);var e=this.game.input.keyboard.addKey(a.Keyboard.FOUR);e.onDown.add(function(){this.showLayer4=!this.showLayer4},this);var f=this.game.input.keyboard.addKey(a.Keyboard.FIVE);f.onDown.add(function(){this.showLayer5=!this.showLayer5},this);var g=this.game.input.keyboard.addKey(a.Keyboard.F);g.onDown.add(function(){this.showFramerate=!this.showFramerate},this);var h=this.game.input.keyboard.addKey(a.Keyboard.P);h.onDown.add(function(){for(var a=0;a<this.emitters.length;a++)this.emitters[a].alive?this.emitters[a].kill():(this.emitters[a].revive(),this.emitters[a].go())},this);var i=this.game.input.keyboard.addKey(a.Keyboard.D);i.onDown.add(function(){this.showDebugInfo=!this.showDebugInfo},this)}},b.Level.prototype.createLayers=function(){var a=this.game.cache.getTilemapData("level").data;if(!a.properties.width||!a.properties.height)throw console.error("Tiled map data must set 'width' and 'height' properties on the map object!"),new Error("Tiled map error: no width/height properties on map");this.world_width=a.properties.width,this.world_height=a.properties.height;for(var c=a.layers,d=0,e=0;e<c.length;e++){var f=c[e];switch(f.type){case"tilelayer":(!this.game.excluded_layers||this.game.excluded_layers&&-1===this.game.excluded_layers.indexOf(f.name))&&this.createTileLayer(f,d),d++;break;case"objectgroup":this.createObjects(f);break;case"imagelayer":this.createImageLayer(f);break;default:console.warn("Unknown layer type '"+f.type+"'in Tiled map file")}}var g=a.properties.main_layer||"main";if(this.main_layer_index=b.findNamedItemInArray(this.layers,g,this.main_layer_index),void 0===this.main_layer_index)throw new Error("No 'main' layer in Tiled map!");if(this.main_layer=this.layers[this.main_layer_index],this.main_layer.resizeWorld(),this.game.world.setBounds(0,0,this.world_width,this.world_height),!this.player)throw new Error("No 'player' sprite in Tiled map!");this.player.group.visible||(this.player.group.visible=!0)},b.Level.prototype.createTileLayer=function(a,c){var d=+(a.properties&&a.properties.scrollFactorX||1),e=+(a.properties&&a.properties.scrollFactorY||1),f=this.game.add.tilemapLayer(0,0,b.VIEW_WIDTH,b.VIEW_HEIGHT,this.tileset,this.map,c);f.name=a.name,f.solid=void 0!==a.properties&&("true"==a.properties.solid?!0:!1),f.visible=a.visible,f.scrollFactorX=d,f.scrollFactorY=e,this.layers.push(f)},b.Level.prototype.createImageLayer=function(a){var c=this.game.add.sprite(0,0,a.name);c.name=a.name;var d=0,e=0,f=this.world_width,g=this.world_height,h=f-b.VIEW_WIDTH,i=g-b.VIEW_HEIGHT;0!==h&&(d=(c.width-b.VIEW_WIDTH)/h),0!==i&&(e=(c.height-b.VIEW_HEIGHT)/i),c.update=function(){this.x=this.game.camera.view.x-this.game.camera.view.x*d,this.y=this.game.camera.view.y-this.game.camera.view.y*e},c.imageLayer=!0,this.image_layers.push(c)},b.Level.prototype.createObjects=function(c){var d=c,e=this.game.add.group();e.name=d.name||"",e.visible=void 0===d.visible?!0:d.visible,e.alpha=+d.opacity||1;for(var f=0;f<d.objects.length;f++){var g,h=d.objects[f];if(this.game_namespace&&(g=this.game_namespace[h.type]),g||(g=b[h.type]),g||(g=window[h.type]),!g)throw new Error("Unable to create Object: '"+h.type+"'");var i=new g(this.game,h.name,h.x,h.y,h.width,h.height,h.properties);"undefined"!=typeof i&&null!==i&&(i.is_player_sprite&&(this.player=i),i instanceof a.Sprite?e.add(i):i instanceof a.Particles.Arcade.Emitter?this.emitters.push(i):i instanceof b.Trigger?this.triggers.push(i):i instanceof b.Alarm?this.alarms.push(i):i instanceof b.Area&&this.areas.push(i))}e.exists=!1,this.groups.push(e)},b.Level.prototype.restart=function(){this.updates=0,this.game.sound.stopAll();for(var a=0;a<this.groups.length;a++)this.groups[a].forEach(c),this.groups[a].exists=!1;this.triggers.forEach(c),this.alarms.forEach(c),this.areas.forEach(c),this.emitters.forEach(c),this.background_music&&this.music.play("",0,this.background_music.volume,!0)},b.Level.prototype.update=function(){if(0===this.updates)for(this.updates++,a=0;a<this.groups.length;a++)this.groups[a].exists=!0;for(var a=0;a<this.layers.length;a++){var b="showLayer"+(a+1);this[b]?"collision"!==this.layers[a].name&&(this.layers[a].visible=!0):this.layers[a].visible=!1}for(this.player.updateObject(),a=0;a<this.groups.length;a++)this.groups[a].forEachAlive(d);this.triggers.forEach(d),this.alarms.forEach(d),this.areas.forEach(d),this.emitters.forEach(d);var c=this.triggers.length;for(a=0;c>a;a++){var e=this.triggers[a];e.trigger_on_touch&&e.checkActivate.call(e)}},b.Level.prototype.render=function(){this.game.paused&&this.game.paused_image?(this.game.paused_image.visible=!0,this.game.paused_image.bringToTop()):this.game.paused_image&&(this.game.paused_image.visible=!1),this.showFramerate&&this.game.debug.renderText(this.game.time.fps,10,25,"#ff0000"),this.showDebugInfo&&(this.game.debug.renderSpriteBody(this.player,"rgba(0,255,0,0.3)"),this.game.debug.renderSpriteCorners(this.player),this.game.world.forEach(function(b){!(b instanceof a.Sprite)||b instanceof a.TileSprite||b instanceof a.TilemapLayer||!b.alive||!b.visible||b.imageLayer||(this.game.debug.renderSpriteBody(b),this.game.debug.renderSpriteCorners(b))},this))}}(),b.StateMachine=function(a,b){this.states=a,this.receiver=b,this.indices={},this.initialState=void 0;for(var c=0;c<a.length;c++)this.indices[this.states[c].name]=c,this.states[c].initial&&(this.initialState=this.states[c]);this.initialState||console.warn("State Machine has no initial state!"),this.currentState=this.initialState},b.StateMachine.prototype.consumeEvent=function(a){this.currentState.events[a]?(this.currentState=this.states[this.indices[this.currentState.events[a]]],this.receiver[this.currentState.name].call(this.receiver)):console.warn("State Machine called with invalid event: '"+a+"' for current state: '"+this.currentState.name+"'.")},b.StateMachine.prototype.getState=function(){return this.currentState.name},b.StateMachine.prototype.reset=function(){this.currentState=this.initialState},function(){b.BaseSprite=function(b,c,d,e,f,g,h){e+=.5*g,f+=.5*h,a.Sprite.call(this,b,e,f,c),this.name=d||"",this.initial_x=e,this.initial_y=f,this.is_player_sprite=!1,this.anchor.x=.5,this.anchor.y=.5,this.x=this.initial_x,this.y=this.initial_y,b.add.existing(this)},b.BaseSprite.prototype=Object.create(a.Sprite),b.__extends(b.BaseSprite,a.Sprite),b.BaseSprite.prototype.constructor=b.BaseSprite,b.BaseSprite.prototype.reset=function(){a.Sprite.prototype.reset.call(this,this.initial_x,this.initial_y),a.Sprite.prototype.updateCache.call(this)},b.Trigger=function(a,b,c,d,e,f,g){this.game=a,this.name=b,this.x=c,this.y=d,this.width=e||1,this.height=f||1,this.props=g||{},this.entity_name=g.entity,this.target_name=g.target||null,this.on_callback=g.on,this.off_callback=g.off||null,this.type=g.type||"Trigger",this.trigger_on_touch="true"===g.trigger_on_touch,this.activated=!1,this.exists=!0,this.body={x:this.x,y:this.y,right:this.x+this.width,bottom:this.y+this.height}},b.Trigger.prototype.reset=function(){this.deactivate()},b.Trigger.prototype.updateObject=function(){this.target_name&&!this.target&&b.resolveTarget(this),this.entity_name&&!this.entity&&(this.entity=b.findNamedItemInGroup(this.game.world,this.entity_name)),this.activated},b.Trigger.prototype.activate=function(){return this.activated?!1:(this.activated=!0,this.on&&this.on instanceof Function?this.on(this,this.entity):this.on_callback&&this.target[this.on_callback]instanceof Function?this.target[this.on_callback](this,this.entity):!0)},b.Trigger.prototype.deactivate=function(){return this.activated?(this.activated=!1,this.off&&this.off instanceof Function?this.off(this,this.entity):this.off_callback&&this.target[this.off_callback]instanceof Function?this.target[this.off_callback](this,this.entity):!0):!1},b.Trigger.prototype.check=function(){return a.Rectangle.intersects(this.body,this.entity.body)},b.Trigger.prototype.checkActivate=function(){return this.check()?this.activate():void 0},b.Trigger.prototype.checkDeactivate=function(){return this.check()?this.deactivate():void 0},b.SetTileTrigger=function(a,c,d,e,f,g,h){b.Trigger.call(this,a,c,d,e,f,g,h),this.game=a,this.game_state=a.state.states[a.state.current],this.map=this.game_state.map,this.old_trigger_tile=void 0,this.new_tile_data=[],this.tiles_saved=!1;var i=h.new_tile_1,j=JSON.parse(i);this.new_tile_data.push(j),"new_tile_2"in h&&(i=h.new_tile_2,j=JSON.parse(i),this.new_tile_data.push(j)),"new_tile_3"in h&&(i=h.new_tile_3,j=JSON.parse(i),this.new_tile_data.push(j)),this.new_trigger_tile=void 0,"new_trigger_tile"in h&&(this.new_trigger_tile=+h.new_trigger_tile),this.trigger_tile_x=void 0,this.trigger_tile_y=void 0,this.sound_effect=h.sound_effect,this.sound_effect&&(this.noise=a.add.audio(this.sound_effect,1,!0)),this.volume=1,"volume"in h&&(this.volume=+h.volume),h.on="on",h.off="off",this.target=this},b.SetTileTrigger.prototype=Object.create(b.Trigger),b.__extends(b.SetTileTrigger,b.Trigger),b.SetTileTrigger.prototype.constructor=b.SetTileTrigger,b.SetTileTrigger.prototype.reset=function(){if(this.activated=!1,this.tiles_saved){for(var a=0;a<this.new_tile_data.length;a++){var c=b.findNamedItemInArray(this.game_state.layers,this.new_tile_data[a].layer),d=+this.new_tile_data[a].x,e=+this.new_tile_data[a].y,f=+this.new_tile_data[a].old_tile;this.map.putTile(f,d,e,c)}this.map.putTile(this.old_trigger_tile,this.trigger_tile_x,this.trigger_tile_y,this.game_state.main_layer_index)}},b.SetTileTrigger.prototype.on=function(){if(void 0===this.old_trigger_tile){for(var a=0;a<this.new_tile_data.length;a++){var c=b.findNamedItemInArray(this.game_state.layers,this.new_tile_data[a].layer),d=+this.new_tile_data[a].x,e=+this.new_tile_data[a].y;this.new_tile_data[a].old_tile=this.map.getTile(d,e,c)}this.tiles_saved=!0}void 0!==this.new_trigger_tile&&void 0===this.old_trigger_tile&&(this.trigger_tile_x=this.game.math.snapToFloor(this.x,this.game_state.main_layer.tileWidth)/this.game_state.main_layer.tileWidth,this.trigger_tile_y=this.game.math.snapToFloor(this.y,this.game_state.main_layer.tileHeight)/this.game_state.main_layer.tileHeight,this.old_trigger_tile=this.map.getTile(this.trigger_tile_x,this.trigger_tile_y,this.game_state.main_layer_index));for(var a=0;a<this.new_tile_data.length;a++){var c=b.findNamedItemInArray(this.game_state.layers,this.new_tile_data[a].layer),d=+this.new_tile_data[a].x,e=+this.new_tile_data[a].y,f=+this.new_tile_data[a].tile;this.map.putTile(f,d,e,c)}return this.new_trigger_tile&&this.map.putTile(this.new_trigger_tile,this.trigger_tile_x,this.trigger_tile_y,this.game_state.main_layer_index),this.noise&&this.noise.play("",0,this.volume),this.map.game.camera.x++,this.map.game.camera.x--,!0},b.SetTileTrigger.prototype.off=function(){for(var a=0;a<this.new_tile_data.length;a++){var c=b.findNamedItemInArray(this.game_state.layers,this.new_tile_data[a].layer),d=+this.new_tile_data[a].x,e=+this.new_tile_data[a].y,f=+this.new_tile_data[a].old_tile;this.map.putTile(f,d,e,c)}return this.new_trigger_tile&&this.map.putTile(this.old_trigger_tile,this.trigger_tile_x,this.trigger_tile_y,this.game_state.main_layer_index),this.noise&&this.noise.play("",0,.5),this.map.game.camera.x+=4,this.map.game.camera.x-=4,!0},b.NextLevelTrigger=function(a,c,d,e,f,g,h){b.Trigger.call(this,a,c,d,e,f,g,h),this.level=+h.level,this.state=a.state,this.fade_color=0,this.one_alpha={alpha:1},this.bg=this.game.add.graphics(0,0),this.bg.alive=!1,h.on="on",void 0===h.trigger_on_touch&&(this.trigger_on_touch=!0)},b.NextLevelTrigger.prototype=Object.create(b.Trigger),b.__extends(b.NextLevelTrigger,b.Trigger),b.NextLevelTrigger.prototype.constructor=b.NextLevelTrigger,b.NextLevelTrigger.prototype.fadeOut=function(){this.bg.beginFill(this.fade_color,1);var a=this.game.camera.x+this.game.stage.bounds.width/2,c=this.game.camera.y+this.game.stage.bounds.height/2,d=1.25*b.VIEW_WIDTH,e=1.25*b.VIEW_HEIGHT;this.bg.drawRect(a-d/2,c-e/2,d,e),this.bg.alpha=0,this.bg.endFill(),this.bg.alive=!0,this.bg.group.bringToTop(this.bg);var f=this.game.add.tween(this.bg);f.to(this.one_alpha,1e3,null),f.onComplete.addOnce(this.changeState,this),f.start()},b.NextLevelTrigger.prototype.changeState=function(){this.state.game.sound.stopAll(),this.game.context&&this.game.context.clearRect(0,0,this.game.canvas.width,this.game.canvas.height);var a={level:this.level};b.saveState(a);var c,d=this.state.states[this.state.current];d.game_namespace&&(c=d.game_namespace["Level_"+this.level]),c||(c=b["Level_"+this.level]),c||(c=window["Level_"+this.level]),c||console.error("Can't create level for NextLevelTrigger"),this.state.add("level-"+this.level,c,!1),this.state.start("level-"+this.level,!0,!0),this.state.remove(d.key),this.bg.alive=!1},b.NextLevelTrigger.prototype.on=function(){return this.fadeOut(),!0},b.TeleportTrigger=function(a,c,d,e,f,g,h){b.Trigger.call(this,a,c,d,e,f,g,h),this.new_x=+h.new_x,this.new_y=+h.new_y,h.on="on",void 0===h.trigger_on_touch&&(this.trigger_on_touch=!0)},b.TeleportTrigger.prototype=Object.create(b.Trigger),b.__extends(b.TeleportTrigger,b.Trigger),b.TeleportTrigger.prototype.constructor=b.TeleportTrigger,b.TeleportTrigger.prototype.on=function(){return this.entity.x=this.new_x,this.entity.y=this.new_y,this.activated=!1,!0},b.ResetLevelTrigger=function(a,c,d,e,f,g,h){b.Trigger.call(this,a,c,d,e,f,g,h),this.activated_time=0,this.fade_color=0,this.one_alpha={alpha:1},this.bg=this.game.add.graphics(0,0),this.bg.alive=!1,this.state=a.state.states[a.state.current],void 0===h.trigger_on_touch&&(this.trigger_on_touch=!0)},b.ResetLevelTrigger.prototype=Object.create(b.Trigger),b.__extends(b.ResetLevelTrigger,b.Trigger),b.ResetLevelTrigger.prototype.constructor=b.ResetLevelTrigger,b.ResetLevelTrigger.prototype.reset=function(){},b.ResetLevelTrigger.prototype.fadeOut=function(){this.bg.beginFill(this.fade_color,1);var a=this.game.camera.x+this.game.stage.bounds.width/2,c=this.game.camera.y+this.game.stage.bounds.height/2,d=1.25*b.VIEW_WIDTH,e=1.25*b.VIEW_HEIGHT;this.bg.drawRect(a-d/2,c-e/2,d,e),this.bg.alpha=0,this.bg.endFill(),this.bg.alive=!0,this.bg.visible=!0,this.bg.group.bringToTop(this.bg);var f=this.game.add.tween(this.bg);f.to(this.one_alpha,1e3,null),f.onComplete.addOnce(this.resetLevel,this),f.start()},b.ResetLevelTrigger.prototype.resetLevel=function(){this.state.restart(),this.bg.alive=!1,this.bg.visible=!1},b.ResetLevelTrigger.prototype.on=function(){return this.activated_time=this.game.time.now,this.state.player&&(this.state.player.body.velocity.x=0,this.state.player.body.velocity.y=0,this.state.player.exists=!1),this.fadeOut(),!0},b.ResetLevelTrigger.prototype.updateObject=function(){b.Trigger.prototype.updateObject.call(this),this.activated&&0!==this.activated_time&&this.game.time.elapsedSince(this.activated_time)>=1500&&(this.activated=!1,this.activated_time=0)},b.Emitter=function(b,c,d,e,f,g,h){if(b.use_particle_effects===!1)return null;var i=new a.Particles.Arcade.Emitter(b,0,0,+h.quantity);i.name=c,b.particles.add(i);var j=d,k=e;i.x=j+f/2,i.y=k+g/2,i.height=g,i.width=f,i.period=+(h.period||0),i.delay=+(h.delay||0);var l=h.image;l||console.error("No image property on Nadion.Emitter object in level json!");var m=h.frames||"0";m=m.split(",");for(var n=0;n<m.length;n++)m[n]=+m[n];return i.makeParticles(l,m),i.minParticleSpeed.x=+(h.minParticleSpeedX||0),i.minParticleSpeed.y=+(h.minParticleSpeedY||0),i.maxParticleSpeed.x=+(h.maxParticleSpeedX||0),i.maxParticleSpeed.y=+(h.maxParticleSpeedY||0),i.minRotation=+(h.minRotation||0),i.maxRotation=+(h.maxRotation||0),i.gravity=+(h.gravity||0),"true"===h.autostart&&i.start(!1,i.period,i.delay),i.constrained="true"===h.constrained,i.constrained?(i._orig_rect=new a.Rectangle(j,k,i.width,i.height),i._rect=new a.Rectangle,i._new_rect=new a.Rectangle,i.updateObject=function(){this._rect.x=this.game.camera.x,this._rect.y=this.game.camera.y,this._rect.width=this.game.camera.width,this._rect.height=this.game.camera.height,a.Rectangle.intersection(this._rect,this._orig_rect,this._new_rect),this.x=this._new_rect.x+this._new_rect.width/2,this.y=this._new_rect.y+this._new_rect.height/2,this.height=this._new_rect.height,this.width=this._new_rect.width}):i.updateObject=function(){},i.reset=function(){this.kill(),"true"===h.autostart&&i.start(!1,i.period,i.delay)},i.go=function(){return this.start(!1,this.period,this.delay),!0},i.stop=function(){return this.kill(),!0},i},b.Alarm=function(a,b,c,d,e,f,g){this.game=a,this.name=b,this.x=c||0,this.y=d||0,this.width=e||1,this.height=f||1,this.props=g||{},this.target_name=g.target||null,this.period=g.period||0,this.call=g.call||null,this.repeating=g.repeating||!1,this.type=g.type||"Alarm",this.activated=!1,this.started=!1,this.start_time=0,this.exists=!0,this.body={x:this.x,y:this.y,right:this.x+this.width,bottom:this.y+this.height}},b.Alarm.prototype.reset=function(){this.activated=!1,this.started=!1,this.start_time=0},b.Alarm.prototype.updateObject=function(){this.target_name&&!this.target&&b.resolveTarget(this),this.started&&this.game.time.elapsedSince(this.start_time)>=this.period&&(this.target&&(this.call&&this.target[this.call]instanceof Function?this.target[this.call](this):this.target.alarm instanceof Function&&this.target.alarm(this)),this.repeating?this.start_time=this.game.time.time:this.started=!1)},b.Alarm.prototype.start=function(){this.started||(this.started=!0,this.start_time=this.game.time.time)},b.Area=function(a,b,c,d,e,f,g){this.game=a,this.name=b,this.x=c,this.y=d,this.width=e||1,this.height=f||1,this.props=g||{},this.entity_name=g.entity,this.target_name=g.target||null,this.on_enter=g.on_enter,this.on_exit=g.on_exit,this.type=g.type||"Area",this.entity_inside=!1,this.exists=!0,this.body={x:this.x,y:this.y,right:this.x+this.width,bottom:this.y+this.height}},b.Area.prototype.updateObject=function(){this.target_name&&!this.target&&b.resolveTarget(this),this.entity_name&&!this.entity&&(this.entity=b.findNamedItemInGroup(this.game.world,this.entity_name));var c=a.Rectangle.intersects(this.body,this.entity.body);c&&!this.entity_inside?(this.entity_inside=!0,this.on_enter&&this.target[this.on_enter]instanceof Function&&this.target[this.on_enter](this)):!c&&this.entity_inside&&(this.entity_inside=!1,this.on_exit&&this.target[this.on_exit]instanceof Function&&this.target[this.on_exit](this))}}(),b});